name: test
on:
  push:
    paths:
      - ".github/workflows/test.yml"
  workflow_dispatch:

jobs:
  clean_up_test:
    runs-on: ubuntu-22.04
    container: 
      image: archlinux:base-devel 
      volumes:
        - /:/host
    steps:
      - name: prepare
        run: |
          pacman -Syu --noconfirm --needed rsync
      - name: cleanup
        run: |
          sudo mkdir /empty -p
          _files=(
            /usr/local/lib/android
            /usr/local/.ghcup
            /usr/local/share/powershell
            /usr/local/share/chromium
            /usr/local/share/vcpkg
            /usr/share/dotnet
            /usr/share/swift
            /opt/hostedtoolcache/CodeQL
          )
          for f in ${_files[@]}; echo "/host/${f}"; done | sudo xargs -n1 rsync -a --delete /empty/
      - name: ssh debug
        uses: mxschmitt/action-tmate@v3
